<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LearnNet | Courses</title>

<link rel="stylesheet" href="responsive.css">

<style>

*{
margin:0;
padding:0;
box-sizing:border-box;
}

html,body{
width:100%;
overflow-x:hidden;
font-family:Arial,sans-serif;

background:
radial-gradient(circle at 15% 20%, #c9d6ff, transparent 45%),
radial-gradient(circle at 85% 80%, #e6d3ff, transparent 45%),
linear-gradient(135deg, #eef2ff, #ffffff);

min-height:100vh;
}

/* NAVBAR */

.navbar{
background:#0a2a66;
color:white;
padding:20px;
display:flex;
justify-content:space-between;
align-items:center;
position:relative;
}

.nav-title{
font-size:2rem;
font-weight:bold;
}

.nav-links{
display:flex;
align-items:center;
}

.nav-links a{
color:white;
margin-left:20px;
text-decoration:none;
font-size:1.1rem;
}

/* HAMBURGER */

.hamburger{
display:none;
font-size:28px;
cursor:pointer;
}

/* MOBILE MENU */

.navbar{
  position:relative; 
}

.nav-links.mobile-active{
  display:flex;
  flex-direction:column;
  position:absolute;
  top:100%;
  left:0;
  right:0;
  margin:0;
  background:#0a2a66;
  padding:0;          
  z-index:999;
}

.nav-links.mobile-active a{
  padding:14px 0;
  margin:0;
  text-align:center;
  border-top:1px solid rgba(255,255,255,0.15);
}

/* COURSE AREA */

.course-section{
margin-top:80px;
padding:40px 30px;
max-width:80vw;
margin:auto;
}

.course-heading{
font-size:2rem;
margin-bottom:20px;
}

/* SLIDER */

.slider-wrapper{
overflow:hidden;
padding:40px 10px;
}

.slider-container{
display:flex;
gap:20px;
transition:.5s ease-in-out;
width:max-content;
padding:20px 0;
}

.course-box{
flex:0 0 250px;
background:white;
height:300px;
border-radius:10px;
padding:20px;
box-shadow:0 4px 10px rgba(0,0,0,.1);
display:flex;
flex-direction:column;
justify-content:space-between;
text-align:center;
transition:.3s;
}

.course-box:hover{
transform:scale(1.08);
}

.course-title{
font-size:1.4rem;
color:#0a2a66;
margin-bottom:10px;
}

.course-description{
color:#555;
flex-grow:1;
}

.course-button{
background:#0a2a66;
color:white;
padding:10px;
border:none;
border-radius:5px;
cursor:pointer;
}

.course-button:hover{
background:#083e99;
}

.course-button:disabled{
background:gray;
cursor:not-allowed;
}

/* CONTROLS */

.slider-controls{
display:flex;
justify-content:center;
gap:20px;
margin-top:20px;
}

.slider-button{
background:#0a2a66;
color:white;
border:none;
padding:10px 20px;
border-radius:5px;
cursor:pointer;
}

.slider-button:disabled{
background:#ccc;
}

/* MODAL */

.modal{
display:none;
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,.5);
justify-content:center;
align-items:center;
z-index:1000;
padding:10px;
}

.modal-content{
background:white;
padding:25px;
border-radius:12px;
width:420px;
max-width:95%;
text-align:center;
position:relative;
}

.close-btn{
position:absolute;
top:15px;
right:18px;
font-size:22px;
cursor:pointer;
font-weight:bold;
}

/* LOGIN AREA */

#loginArea input{
width:90%;
padding:8px;
margin-bottom:10px;
border-radius:5px;
border:1px solid #ccc;
}

/* GROUP SLIDER */

.programming-wrapper{
overflow:hidden;
padding:20px;
}

.programming-container{
display:flex;
gap:20px;
transition:.5s;
width:max-content;
}

/* MY COURSES */

#myCoursesList{
list-style:none;
padding-left:0;
}

#myCoursesList li{
padding:12px;
margin:10px 0;
background:#f4f6ff;
border-radius:12px;
cursor:pointer;
font-weight:600;
}

/* MOBILE */

@media(max-width:1024px){

.hamburger{
display:block;
}

.nav-links{
display:none;
}

.course-section{
max-width:95vw;
padding:20px;
margin-top:60px;
}

.course-box{
flex:0 0 200px;
min-height:300px;
min-width: 170px;
}

.course-heading{
font-size:1.6rem;
}
}

@media(max-width:480px){

.course-box{
flex:0 0 160px;
min-height:240px;
}

.course-title{
font-size:1.05rem;
}

.slider-wrapper{
padding:20px 5px;
}
}

</style>
</head>

<body>

<nav class="navbar">

<div class="nav-title">LearnNet</div>

<div class="hamburger" onclick="toggleMenu()">â˜°</div>

<div class="nav-links" id="navMenu">
<a href="index.html">Home</a>
<a href="#" id="myCoursesLink">My Courses</a>
<a href="#" id="logoutBtn">Logout</a>
</div>

</nav>

<div class="course-section">

<div class="course-heading">Courses Offered</div>

<div class="slider-wrapper">
<div class="slider-container" id="slider"></div>
</div>

<div class="slider-controls">
<button class="slider-button" id="prevBtn" disabled>Previous</button>
<button class="slider-button" id="nextBtn">Next</button>
</div>

</div>

<!-- MAIN MODAL -->

<div class="modal" id="modal">
<div class="modal-content">

<span class="close-btn" onclick="closeModal()">âœ–</span>

<h3 id="modalTitle"></h3>

<div id="loginArea" style="display:none">

<input id="usernameInput" placeholder="Username">
<input id="passwordInput" type="password" placeholder="Password">

<button class="course-button" onclick="confirmEnroll()">Confirm</button>

</div>

<div id="modalBody"></div>

</div>
</div>

<!-- MY COURSES MODAL -->

<div class="modal" id="myCoursesModal">
<div class="modal-content" style="width:380px;">

<span class="close-btn" onclick="closeMyCoursesModal()">âœ–</span>

<h3>ðŸ“š My Enrolled Courses</h3>

<ul id="myCoursesList"></ul>

</div>
</div>

<script>

/* HAMBURGER */

function toggleMenu(){
document.getElementById("navMenu").classList.toggle("mobile-active");
}

/* ORIGINAL FULL JS BELOW */

const slider=document.getElementById("slider");
const prevBtn=document.getElementById("prevBtn");
const nextBtn=document.getElementById("nextBtn");

const modal=document.getElementById("modal");
const modalTitle=document.getElementById("modalTitle");
const modalBody=document.getElementById("modalBody");

function getBoxWidth(){
  if(window.innerWidth <= 480) return 180;
  if(window.innerWidth <= 768) return 220;
  return 310;
}

let currentIndex=0;
let maxIndex=0;

let allCourses=[];
let enrolled=new Set();
let selectedCourse="";

/* LOAD COURSES */

async function loadCourses(){

const res=await fetch("/api/courses");
allCourses=await res.json();

slider.innerHTML="";

allCourses.forEach(course=>{

if(course.subCourses && course.subCourses.length){

slider.innerHTML+=`
<div class="course-box">
<div>
<div class="course-title">${course.name}</div>
<div class="course-description">${course.description}</div>
</div>
<button class="course-button" onclick='openGroup("${course._id}")'>
Explore
</button>
</div>`;

}else{

slider.innerHTML+=`
<div class="course-box">
<div>
<div class="course-title">${course.name}</div>
<div class="course-description">${course.description}</div>
</div>
<button class="course-button" onclick='openEnroll("${course.name}")'>
Enroll
</button>
</div>`;

}

});

calculateMax();
await fetchEnrollments();
updateEnrollUI();
}

/* SLIDER */

function updateSlider(){
  const boxWidth = getBoxWidth();
  slider.style.transform=`translateX(-${currentIndex*boxWidth}px)`;
  prevBtn.disabled=currentIndex===0;
  nextBtn.disabled=currentIndex>=maxIndex;
}


function calculateMax(){

  const boxWidth = getBoxWidth();
  const wrapper=document.querySelector(".slider-wrapper").offsetWidth;
  const total=document.querySelectorAll(".course-box").length;
  const perView=Math.floor(wrapper/boxWidth);

  maxIndex=Math.max(total-perView,0);
  updateSlider();
}


nextBtn.onclick=()=>{if(currentIndex<maxIndex){currentIndex++;updateSlider();}};
prevBtn.onclick=()=>{if(currentIndex>0){currentIndex--;updateSlider();}};

/* GROUP MODAL */

function openGroup(id){

const group=allCourses.find(c=>c._id===id);
if(!group) return;

modalTitle.innerText=group.name;

let html=`<div class="programming-wrapper">
<div class="programming-container">`;

group.subCourses.forEach(sub=>{

html+=`
<div class="course-box" style="width:230px;height:290px;cursor:pointer;"
onclick="window.location.href='course.html?name=${encodeURIComponent(sub.name)}'">
<div>
<div class="course-title">${sub.name}</div>
<div class="course-description">${sub.description}</div>
</div>
<button class="course-button"
onclick="event.stopPropagation(); openEnroll('${sub.name}')">
Enroll
</button>
</div>`;

});

html+=`</div></div>

<div class="slider-controls">
<button class="slider-button" id="gPrev" disabled>Previous</button>
<button class="slider-button" id="gNext">Next</button>
</div>`;

modalBody.innerHTML=html;
document.getElementById("loginArea").style.display="none";
modal.style.display="flex";

setupGroupSlider();
updateEnrollUI();
}

/* GROUP SLIDER */

function setupGroupSlider(){

const container=document.querySelector(".programming-container");
const wrapper=document.querySelector(".programming-wrapper");
const prev=document.getElementById("gPrev");
const next=document.getElementById("gNext");

let index=0;
const cardWidth=290;

const total=container.children.length;
const perView=Math.floor(wrapper.offsetWidth/cardWidth);
let max=Math.max(total-perView,0);

function update(){
container.style.transform=`translateX(-${index*cardWidth}px)`;
prev.disabled=index===0;
next.disabled=index>=max;
}

next.onclick=()=>{if(index<max){index++;update();}};
prev.onclick=()=>{if(index>0){index--;update();}};

update();
}

/* ENROLL MODAL */

function openEnroll(courseName){

selectedCourse = courseName;

modalTitle.innerText = `Enroll in ${courseName}`;

modalBody.innerHTML="";
document.getElementById("loginArea").style.display="block";

modal.style.display="flex";

const saved = localStorage.getItem("username");

if(saved){
usernameInput.value = saved;
usernameInput.readOnly = true;
setTimeout(()=>passwordInput.focus(),100);
}else{
usernameInput.value="";
usernameInput.readOnly=false;
setTimeout(()=>usernameInput.focus(),100);
}

passwordInput.value="";
}

/* CONFIRM ENROLL */

async function confirmEnroll(){

const username=usernameInput.value.trim();
const password=passwordInput.value.trim();

if(!username || !password){
alert("Fill all fields");
return;
}

const login=await fetch("/user/login",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({username,password})
});

if(!login.ok){
alert("Incorrect password");
passwordInput.value="";
passwordInput.focus();
return;
}

localStorage.setItem("username",username);

await fetch("/user/enroll",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({username,courseName:selectedCourse})
});

enrolled.add(selectedCourse);
updateEnrollUI();
closeModal();

alert(`Enrolled in ${selectedCourse}!`);

setTimeout(()=>{
window.location.href=`course.html?name=${encodeURIComponent(selectedCourse)}`;
},300);
}

/* ENROLL STATE */

async function fetchEnrollments(){

const username=localStorage.getItem("username");
if(!username) return;

const res=await fetch(`/user/enrollments/${username}`);
const data=await res.json();

enrolled=new Set(data.courses||[]);
}

function updateEnrollUI(){

document.querySelectorAll(".course-box").forEach(box=>{

const title=box.querySelector(".course-title")?.innerText;
const btn=box.querySelector(".course-button");

if(enrolled.has(title)){
btn.textContent="Enrolled";
btn.disabled=true;
}

});
}

/* CLOSE */

function closeModal(){
modal.style.display="none";
document.getElementById("loginArea").style.display="none";
}

function closeMyCoursesModal(){
document.getElementById("myCoursesModal").style.display="none";
}

/* MY COURSES */

document.getElementById("myCoursesLink").onclick=async e=>{

e.preventDefault();

const username=localStorage.getItem("username");
if(!username) return;

const res=await fetch(`/user/enrollments/${username}`);
const data=await res.json();

const list=document.getElementById("myCoursesList");
list.innerHTML="";

if(!data.courses.length){
list.innerHTML="<li>No courses yet</li>";
}else{
data.courses.forEach(c=>{
const li=document.createElement("li");
li.innerText=c;
li.onclick=()=>{
window.location.href=`course.html?name=${encodeURIComponent(c)}`;
};
list.appendChild(li);
});
}

document.getElementById("myCoursesModal").style.display="flex";
};

/* LOGOUT */

document.getElementById("logoutBtn").onclick=()=>{
localStorage.removeItem("username");
location.href="auth.html";
};

/* INIT */

document.addEventListener("DOMContentLoaded",loadCourses);
window.addEventListener("resize",calculateMax);

document.addEventListener("keydown", e=>{
if(modal.style.display==="flex" && e.key==="Enter"){
e.preventDefault();
confirmEnroll();
}
});

</script>
<script src="chatbot-inject.js"></script>


</body>
</html>
