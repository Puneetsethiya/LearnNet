<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Dashboard | LearnNet</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
:root{
--bg:#f1f5f9;
--primary:#2d3748;
--accent:#6b46c1;
--hover:#805ad5;
--white:#fff;
--shadow:rgba(0,0,0,.1);
}

body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:var(--bg);
}

/* ================= DESKTOP ORIGINAL ================= */

.navbar{
background:var(--primary);
color:white;
padding:16px 30px;
display:flex;
justify-content:space-between;
font-size:1.3em;
align-items:center;
position:fixed;
top:0;
width:100%;
z-index:1000;
}

.nav-title{
font-size:1.8em;
font-weight:bold;
white-space:nowrap;
}

.sidebar{
position:fixed;
top:80px;
left:0;
width:250px;
height:calc(100% - 80px);
background:var(--primary);
padding:20px 0;
display:flex;
flex-direction:column;
gap:15px;
}

.sidebar a{
color:white;
text-decoration:none;
padding:12px 20px;
font-size:1.1em;
display:flex;
align-items:center;
gap:10px;
transition:.3s;
}

.sidebar a:hover{
background:var(--hover);
border-radius:0 6px 6px 0;
}

.dashboard-content{
margin-left:270px;
padding:110px 30px 40px;
}

h1{
font-size:2.2em;
margin-bottom:30px;
margin-left: 10%;
}

.dashboard-box{
display:flex;
gap:30px;
flex-wrap:wrap;
}

.box{
flex:1 1 calc(33% - 30px);
background:linear-gradient(145deg,#fff,#e0e7ff);
padding:30px;
border-radius:15px;
box-shadow:0 8px 20px var(--shadow);
text-align:center;
transition:.3s;
}

.box:hover{
transform:translateY(-5px);
}

.box h3{
color:var(--accent);
font-size:1.6em;
}

.box p{
font-size:2em;
font-weight:bold;
}

table{
width:100%;
border-collapse:collapse;
margin-top:20px;
background:white;
box-shadow:0 6px 15px var(--shadow);
border-radius:10px;
overflow:hidden;
}

thead{
background:#6b46c1;
color:white;
}

th,td{
padding:12px;
border-bottom:1px solid #ddd;
text-align:center;
}

/* ================= HAMBURGER ================= */

.hamburger{
display:none;
cursor:pointer;
}

/* ================= MOBILE (ONLY) ================= */

@media(max-width:900px){

/* navbar fix */
.navbar{
  padding:12px 14px;
  justify-content:space-between;
}

/* smaller title so hamburger fits */
.nav-title{
  font-size:0.85em;
  max-width:70%;
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}

/* FORCE hamburger visible */
.hamburger{
  display:block !important;
  font-size:26px;
  color:white;
    margin-right:25px; 
}

/* slide sidebar */
.sidebar{
  left:-260px;
  transition:.3s ease;
  top:50px;
}

.sidebar.mobile-open{
  left:0;
}

/* remove left padding completely */
.dashboard-content{
  margin-left:0 !important;
  padding:110px 10px 30px;   /* ðŸ‘ˆ no left shift */
}

/* perfectly center cards */
.dashboard-box{
  flex-direction:column;
  align-items:center;
  width:100%;
}

/* cards not zoomed */
.box{
  width:80%;
  /* max-width:380px; */
  margin:0 auto;
}

/* table scroll clean */
.table-wrapper{
  overflow-x:auto;
}

table{
  min-width:600px;
}

}

</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">

<div class="nav-title">
<i class="fas fa-chalkboard-teacher"></i> LearnNet Admin Dashboard
</div>

<div class="hamburger" onclick="toggleSidebar()">â˜°</div>

</nav>

<!-- SIDEBAR -->
<div class="sidebar">

<a href="admindashboard.html"><i class="fas fa-home"></i> Dashboard</a>
<a href="manageusers.html"><i class="fas fa-users-cog"></i> Manage Users</a>
<a href="managecourses.html"><i class="fas fa-book"></i> Manage Courses</a>
<a href="index.html" id="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>

</div>

<!-- CONTENT -->
<div class="dashboard-content">

<h1>Welcome Admin ðŸ‘‹</h1>

<div class="dashboard-box">

<div class="box">
<h3>Total Users</h3>
<p id="userCount">Loading...</p>
</div>

<div class="box">
<h3>Total Courses</h3>
<p id="courseCount">Loading...</p>
</div>

</div>

<h2 style="margin-top:60px;">Enrolled Users</h2>

<div class="table-wrapper">
<table>
<thead>
<tr>
<th>Username</th>
<th>Course</th>
<th>Enrollment Date</th>
</tr>
</thead>
<tbody id="enrollmentTable"></tbody>
</table>
</div>

</div>

<script>

function toggleSidebar(){
document.querySelector(".sidebar").classList.toggle("mobile-open");
}

/* LOAD DASHBOARD */

async function loadDashboardData(){
try{
const res = await fetch("http://localhost:3000/admin/overview");
if(!res.ok) throw new Error();

const data = await res.json();
const enrollments = data.all || [];

/* counts */
const users=[...new Set(enrollments.map(e=>e.username))];
const courses=[...new Set(enrollments.map(e=>e.courseName))];

userCount.innerText=users.length;
courseCount.innerText=courses.length;

/* table */
const table=enrollmentTable;
table.innerHTML="";

if(!enrollments.length){
table.innerHTML=`<tr><td colspan="3">No enrollments found</td></tr>`;
return;
}

enrollments.forEach(e=>{
const row=document.createElement("tr");
row.innerHTML=`
<td>${e.username}</td>
<td>${e.courseName}</td>
<td>${new Date(e.createdAt).toLocaleDateString()}</td>

`;
table.appendChild(row);
});

}catch{
userCount.innerText="N/A";
courseCount.innerText="N/A";
enrollmentTable.innerHTML=
`<tr><td colspan="3">Failed to load</td></tr>`;
}
}

/* LOGOUT */
logout.onclick=e=>{
e.preventDefault();
location.href="auth.html";
};

document.addEventListener("DOMContentLoaded",loadDashboardData);

</script>

</body>
</html>
